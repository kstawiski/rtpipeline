# =================================================================================================
# Evidence-Based pyRadiomics Configuration for Clinical Research
#
# Based on comprehensive literature review and clinical validation studies:
# - Tier 1 features prioritized (ICC >0.9): First-order, Shape, Select GLCM
# - Biorthogonal 1.1 wavelet for optimal clinical performance (97% accuracy)
# - IBSI-compliant settings with clinical adaptations
# - Multi-scale LoG filtering for edge enhancement (sigma 1.0-5.0mm validated)
# - Quality control parameters to ensure stable feature extraction
# =================================================================================================

setting:
  # ----------------------------------------------------------
  # Image Pre-processing and Harmonization (Clinical Grade)
  # ----------------------------------------------------------
  
  # Isotropic resampling crucial for rotation-invariant features
  # 1x1x1mm provides optimal balance for CT/MRI applications
  resampledPixelSpacing: [1.0, 1.0, 1.0]
  
  # B-spline interpolation preserves image information during resampling
  interpolator: 'sitkBSpline'
  
  # Z-score normalization standardizes intensities across scanners/subjects
  # Critical for MRI; beneficial for multi-center CT studies
  normalize: True
  normalizeScale: 1
  
  # Remove outliers for improved stability (3 standard deviations)
  removeOutliers: 3
  
  # ----------------------------------------------------------
  # Intensity Discretization (Evidence-Based)
  # ----------------------------------------------------------
  
  # Fixed bin width more robust than fixed bin count for multi-center studies
  # 25 HU validated for CT applications; provides 30-130 bins typically
  binWidth: 25
  
  # Alternative for MRI applications (uncomment if needed):
  # binCount: 64  # Recommended for MRI per clinical studies
  
  # ----------------------------------------------------------
  # ROI Quality Control and Validation
  # ----------------------------------------------------------
  
  # Ensure true 3D analysis for stable texture statistics
  minimumROIDimensions: 3
  
  # Minimum voxels for stable texture features (clinical threshold)
  minimumROISize: 100
  
  # First-order neighbors standard for texture matrices
  distances: [1]
  
  # 3D texture analysis preferred over 2D
  force2D: False
  force2Ddimension: 0
  
  # ----------------------------------------------------------
  # IBSI Compliance and Geometry Handling
  # ----------------------------------------------------------
  
  # IBSI-recommended padding distance for kernel operations
  padDistance: 5
  
  # Geometry tolerance for image-mask alignment
  geometryTolerance: 1e-6
  
  # Resample mask to image geometry when needed
  correctMask: True
  
  # IBSI energy calculation compliance
  voxelArrayShift: 0
  
  # ----------------------------------------------------------
  # Provenance and Quality Assurance
  # ----------------------------------------------------------
  
  # Essential for reproducibility - includes all processing details
  additionalInfo: True
  
  # Target label for feature extraction
  label: 1
  
  # Disable pre-cropping to maintain intensity normalization accuracy
  preCrop: False

# ============================================================
# Image Types: Evidence-Based Filter Selection
# Prioritizes clinically-validated filters with proven biomarker performance
# ============================================================
imageType:
  # Essential baseline - always include original images
  Original: {}
  
  # Biorthogonal 1.1 wavelet for optimal clinical performance (97% accuracy)
  # Provides multi-resolution texture analysis with superior stability
  Wavelet:
    wavelet: 'bior1.1'
    
  # Multi-scale Laplacian of Gaussian for edge enhancement
  # Sigma 1.0-5.0mm captures lesion characteristics across scales
  LoG:
    sigma: [1.0, 3.0, 5.0]
    
  # Advanced filters disabled by default - enable for specific hypotheses
  # Square: {}        # Amplifies high-intensity regions
  # SquareRoot: {}    # Enhances low-intensity contrast
  # Logarithm: {}     # Wide dynamic range compression
  # Exponential: {}   # Extreme value emphasis
  # Gradient: {}      # Edge strength quantification
  # LBP3D: {}         # Micro-texture patterns (specialized use)

# ============================================================
# Feature Classes: Tier-Based Selection for Clinical Robustness
# All classes enabled for comprehensive extraction, but post-extraction
# filtering should prioritize Tier 1 features (ICC >0.9) for clinical models
# ============================================================
featureClass:
  # Tier 1: Highest Clinical Utility (ICC >0.9)
  shape: []      # Volume, sphericity, compactness - 94% stability
  firstorder: [] # Mean, median, entropy - 91-95% stability
  
  # Tier 2: Good Clinical Utility (ICC 0.8-0.9)  
  glcm: []       # Contrast, correlation, joint entropy validated
  
  # Tier 3: Moderate Utility (ICC 0.75-0.85) - Use with caution
  glrlm: []      # Run length patterns
  glszm: []      # Size zone patterns
  gldm: []       # Dependence patterns
  
  # WARNING: NGTDM features show poor stability (ICC <0.75 in >60% studies)
  # Include only if specifically validated for your application
  ngtdm: []
  
# =================================================================================================
# POST-EXTRACTION RECOMMENDATIONS:
# 1. Apply robustness filtering: Remove features with ICC <0.75
# 2. Exclude volume-confounded features: Energy, TotalEnergy, RMS
# 3. Handle correlated features: Remove pairs with r >0.95
# 4. Consider ComBat harmonization for multi-center studies (26% â†’ 91% stability)
# 5. Prioritize validated feature combinations from clinical literature
# =================================================================================================
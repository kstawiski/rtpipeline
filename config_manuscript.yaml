# Snakemake configuration for RTpipeline manuscript analysis
# Uses existing Output directory with Example_data

container_mode: false

# Input/Output directories - use existing Output directory
dicom_root: "Example_data"
output_dir: "Output"
logs_dir: "Logs"

# Processing parameters
max_workers: 4

# Scheduler overrides
scheduler:
  reserved_cores: 1
  parallel_courses: 2
  prioritize_short_courses: true

# Organize step optimizations
organize:
  dedup_by_sop_uid: true
  use_hardlinks: true
  verify_checksum: false
  cache_headers: true

segmentation:
  max_workers: 1
  force: false
  fast: false
  roi_subset: null
  extra_models: []
  device: "cpu"  # Use CPU for this run
  force_split: true
  nr_threads_resample: null
  nr_threads_save: null
  num_proc_preprocessing: 1
  num_proc_export: 1

custom_models:
  enabled: false
  root: "custom_models"
  models: []
  max_workers: null
  force: false

radiomics:
  sequential: false
  params_file: "rtpipeline/radiomics_params.yaml"
  mr_params_file: "rtpipeline/radiomics_params_mr.yaml"
  skip_rois:
    - body
    - couchsurface
    - couchinterior
    - couchexterior
    - bones
    - m1
    - m2
  max_voxels: 1500000000
  min_voxels: 10

# Radiomics robustness analysis
radiomics_robustness:
  enabled: true
  modes:
    - segmentation_perturbation
  segmentation_perturbation:
    apply_to_structures:
      - "GTV*"
      - "CTV*"
      - "PTV*"
      - "pelvic_bones*"
      - "iliac_*"
      - "bowel_bag"
      - "urinary_bladder"
      - "colon"
      - "prostate"
      - "rectum"
    small_volume_changes: [-0.15, 0.0, 0.15]
    large_volume_changes: [-0.30, 0.0, 0.30]
    max_translation_mm: 0.0
    n_random_contour_realizations: 0
    noise_levels: [0.0]
    intensity: "standard"
  metrics:
    icc:
      implementation: "pingouin"
      icc_type: "ICC3"
      ci: true
    cov:
      enabled: true
    qcd:
      enabled: true
  thresholds:
    icc:
      robust: 0.90
      acceptable: 0.75
    cov:
      robust: 10.0
      acceptable: 25.0

# DVH Configuration
dvh:
  enabled: true
  force: false
  prescription_dose_source: "auto"
  volume_type: "relative"
  dose_presentation: "absolute"
  dose_metrics:
    - Dmean
    - Dmax
    - Dmin
    - D95
    - D98
    - D2
    - D50
  volume_metrics:
    - V95%Rx
    - V100%Rx

# CT Cropping
ct_cropping:
  enabled: true
  region: "pelvis"

# QC Configuration
qc:
  enabled: true
  force: false
